# Calculate the availability percentage
$availabilityPercentage = [math]::Round(($availability / $vmUsage.Limit) * 100, 2)

Write-Output "Availability Percentage: $availabilityPercentage%"

$newLimit = [math]::Ceiling($vmUsage.Limit * 1.3)


$smtpServer = "smtp.office365.com"
$smtpPort = 587
$smtpUsername = "your-email@example.com"
$smtpPassword = "your-password"
$fromEmail = "your-email@example.com"
$toEmail = "recipient-email@example.com"
$subject = "Test Email"
$body = "This is a test email from Azure Automation Runbook."

# Create a credential object for SMTP authentication
$smtpCredential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $smtpUsername, (ConvertTo-SecureString -String $smtpPassword -AsPlainText -Force)

# Send the email
Send-MailMessage -SmtpServer $smtpServer -Port $smtpPort -UseSsl -Credential $smtpCredential -From $fromEmail -To $toEmail -Subject $subject -Body $body

