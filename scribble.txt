trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  retentionDays: 30  # Change as per your requirement.

steps:
- task: AzureCLI@2
  displayName: 'Clean ACR Images'
  inputs:
    azureSubscription: '<Your-Azure-Subscription>'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      registry=<Your-Registry>
      image=<Your-Image-Name>
      servicePrincipalId=<Your-Service-Principal-Id>
      retentionTime=$(date -d "-${{ variables.retentionDays }} days" --utc +%Y-%m-%dT%H:%M:%SZ)
      
      echo "Purging images older than $retentionTime from $registry/$image"
      acr-purge --registry $registry --image $image --ago $retentionTime --service-principal-id $servicePrincipalId
