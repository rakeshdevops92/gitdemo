pipeline {
    agent any
    stages {
        stage('setup kubeconfig') {
          steps {
            withCredentials([file(credentialsId: 'eks', variable: 'cd_config')]) {
                sh "sudo cp \${cd_config} ${WORKSPACE}"
            }
          }
        }
        stage('deploy') {
          steps {
             sh '''
                sudo kubectl get nodes --kubeconfig ${WORKSPACE}/cd_config
                '''
          }            
        }
        stage('remove kubeconfig file') {
            steps {
                    sh "sudo rm -rf ${WORKSPACE}/cd_config"
            }
        }
    }
}
