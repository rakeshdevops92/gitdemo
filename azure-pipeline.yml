steps:
- task: PowerShell@2
  displayName: "Update Version in .csproj Files"
  inputs:
    targetType: 'inline'
    script: |
      $inputVersion = "$(inputVersion)"
      
      $filePaths = @(
          "$(Build.SourcesDirectory)\assemblyversion\HP.HPX.csproj",
          "$(Build.SourcesDirectory)\assemblyversion\DesktopExtension.csproj"
      )

      function Update-VersionInCsproj {
          param (
              [string]$filePath,
              [string]$version
          )
          
          $content = Get-Content $filePath
          
          $content = $content -replace '(?<=<PackageReference Include="HP.PenControl" Version=")[^"]+', $version
          $content = $content -replace '(?<=<Content Include="\.\.\\packages\\HP\.PenControl\\)[^\\]+', $version
          
          Set-Content -Path $filePath -Value $content -Encoding UTF8
          
          Write-Host "Updated version to $version in $filePath"
      }

      foreach ($file in $filePaths) {
          if (Test-Path $file) {
              Update-VersionInCsproj -filePath $file -version $inputVersion
          } else {
              Write-Host "File not found: $file"
          }
      }
