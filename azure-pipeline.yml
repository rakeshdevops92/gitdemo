trigger:
  - main

pool:
  name: JVS-NR-eastus2-pprdce01-ado-agentpool-01

variables:
  - group: dniprd

parameters:
  - name: methodName
    type: string
    default: "create_cloud_node"
    values:
      - "get_staging_client"
      - "create_cloud_node"
      - "assign_location"
      - "update_reachability"
      - "create_topology_vlan"
      - "delete_cloud_node"

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.10.12'
      addToPath: true

  - script: |
      curl -x http://proxy.conexus.svc.local:3128 https://dni-api-stg.npnd.gw.att.com > linkid.txt
      cat linkid.txt
    displayName: 'Process LinkID'

  - script: |
      python -m pip install --upgrade pip
      pip install --force-reinstall --no-cache-dir cryptography
      pip install -r code/dni/requirements.txt
      export PATH="$HOME/.local/bin:$PATH"
    displayName: 'Reinstall and Install Python Dependencies'

  - script: |
      export PATH="$HOME/.local/bin:$PATH"
      export tenant_id=${{ variables.tenant_id }}
      export app_id=${{ variables.app_id }}
      export passwd=${{ variables.passwd }}
      export account_id=${{ variables.account_id }}
      export rm_url=${{ variables.rm_url }}
      export sa_connect_str=${{ variables.sa_connect_str }}

      python dni_client_demo.py --method ${{ parameters.methodName }}
    displayName: 'Run Python Script with Selected Method'
